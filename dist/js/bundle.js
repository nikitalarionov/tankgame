!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=13)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.throttle=e.debounce=e.lvlBlockFactory=e.getRandomNum=e.getCanvasEl=void 0;var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};e.randomIntFromRange=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},e.randomColor=function(t){return t[Math.floor(Math.random()*t.length)]},e.distance=function(t,e,i,n){var o=i-t,r=n-e;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))};var o=i(2);e.getCanvasEl=function(){var t=document.querySelector("canvas");return t.width=innerWidth,t.height=innerHeight,t},e.getRandomNum=function(t,e){return Math.floor(Math.random()*e-t)+t};e.lvlBlockFactory=function(t,e,i){var r={w:50,h:50};return new o.LevelBlock({color:["grey","green","blue"][t],position:{x:r.w*i,y:r.h*e},rect:n({},r)})},e.debounce=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=null;return function(){for(var o=arguments.length,r=Array(o),a=0;a<o;a++)r[a]=arguments[a];n&&clearTimeout(n),n=setTimeout(function(){console.log(r),t.apply(i,r),n=null},e)}},e.throttle=function(t,e,i){var n,o,r=!1;return function a(){if(r)return n=arguments,void(o=this);t.apply(i,arguments),r=!0,setTimeout(function(){r=!1,n&&(a.apply(o,n),n=o=null)},e)}}},function(t,e){function i(t,e){if(!(this instanceof i))return new i(t,e);this.x=t||0,this.y=e||0}t.exports=i,i.fromArray=function(t){return new i(t[0]||0,t[1]||0)},i.fromObject=function(t){return new i(t.x||0,t.y||0)},i.prototype.addX=function(t){return this.x+=t.x,this},i.prototype.addY=function(t){return this.y+=t.y,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},i.prototype.addScalarX=function(t){return this.x+=t,this},i.prototype.addScalarY=function(t){return this.y+=t,this},i.prototype.subtractX=function(t){return this.x-=t.x,this},i.prototype.subtractY=function(t){return this.y-=t.y,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},i.prototype.subtractScalarX=function(t){return this.x-=t,this},i.prototype.subtractScalarY=function(t){return this.y-=t,this},i.prototype.divideX=function(t){return this.x/=t.x,this},i.prototype.divideY=function(t){return this.y/=t.y,this},i.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.prototype.divideScalar=function(t){return 0!==t?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},i.prototype.divideScalarX=function(t){return 0!==t?this.x/=t:this.x=0,this},i.prototype.divideScalarY=function(t){return 0!==t?this.y/=t:this.y=0,this},i.prototype.invertX=function(){return this.x*=-1,this},i.prototype.invertY=function(){return this.y*=-1,this},i.prototype.invert=function(){return this.invertX(),this.invertY(),this},i.prototype.multiplyX=function(t){return this.x*=t.x,this},i.prototype.multiplyY=function(t){return this.y*=t.y,this},i.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.prototype.multiplyScalarX=function(t){return this.x*=t,this},i.prototype.multiplyScalarY=function(t){return this.y*=t,this},i.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=1,this.y=0):this.divide(i(t,t)),this},i.prototype.norm=i.prototype.normalize,i.prototype.limit=function(t,e){return Math.abs(this.x)>t&&(this.x*=e),Math.abs(this.y)>t&&(this.y*=e),this},i.prototype.randomize=function(t,e){return this.randomizeX(t,e),this.randomizeY(t,e),this},i.prototype.randomizeX=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x);return this.x=o(i,n),this},i.prototype.randomizeY=function(t,e){var i=Math.min(t.y,e.y),n=Math.max(t.y,e.y);return this.y=o(i,n),this},i.prototype.randomizeAny=function(t,e){return Math.round(Math.random())?this.randomizeX(t,e):this.randomizeY(t,e),this},i.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},i.prototype.toFixed=function(t){return void 0===t&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},i.prototype.mixX=function(t,e){return void 0===e&&(e=.5),this.x=(1-e)*this.x+e*t.x,this},i.prototype.mixY=function(t,e){return void 0===e&&(e=.5),this.y=(1-e)*this.y+e*t.y,this},i.prototype.mix=function(t,e){return this.mixX(t,e),this.mixY(t,e),this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.copyX=function(t){return this.x=t.x,this},i.prototype.copyY=function(t){return this.y=t.y,this},i.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},i.prototype.zero=function(){return this.x=this.y=0,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.projectOnto=function(t){var e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this},i.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},i.prototype.horizontalAngleDeg=function(){return r(this.horizontalAngle())},i.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},i.prototype.verticalAngleDeg=function(){return r(this.verticalAngle())},i.prototype.angle=i.prototype.horizontalAngle,i.prototype.angleDeg=i.prototype.horizontalAngleDeg,i.prototype.direction=i.prototype.horizontalAngle,i.prototype.rotate=function(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),i=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=e,this.y=i,this},i.prototype.rotateDeg=function(t){return t=a(t),this.rotate(t)},i.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},i.prototype.rotateToDeg=function(t){return t=a(t),this.rotateTo(t)},i.prototype.rotateBy=function(t){var e=this.angle()+t;return this.rotate(e)},i.prototype.rotateByDeg=function(t){return t=a(t),this.rotateBy(t)},i.prototype.distanceX=function(t){return this.x-t.x},i.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},i.prototype.distanceY=function(t){return this.y-t.y},i.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},i.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},i.prototype.distanceSq=function(t){var e=this.distanceX(t),i=this.distanceY(t);return e*e+i*i},i.prototype.length=function(){return Math.sqrt(this.lengthSq())},i.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},i.prototype.magnitude=i.prototype.length,i.prototype.isZero=function(){return 0===this.x&&0===this.y},i.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},i.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},i.prototype.toArray=function(){return[this.x,this.y]},i.prototype.toObject=function(){return{x:this.x,y:this.y}};var n=180/Math.PI;function o(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function r(t){return t*n}function a(t){return t/n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Enemy=e.EnemyTank=e.Tank=e.Bullet=e.LevelBlock=void 0;var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(0),a=i(11),s=i(9),h=l(i(1)),u=l(i(8));function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function(){function t(e){p(this,t),this.velocity=300,this.life=100,this.display=!0,this.state={moving:!1},this.direction={up:!1,down:!1,left:!1,right:!1},this.dirVec=new h.default(0,0);var i=e.color,n=e.position,o=e.rect,r=e.remove;this.color=i,"function"==typeof r&&(this.remove=r.bind(this)),this.position=n||new h.default(0,0),o||(o=this.getDefaultSize()),this.rect=o;var s=o,u=s.w,l=s.h;u&&l&&(this.w=u,this.h=l),this.queue=new a.CommandQueue(this)}return o(t,[{key:"x",get:function(){return this.position.x}},{key:"y",get:function(){return this.position.y}},{key:"minX",get:function(){return this.position.x}},{key:"minY",get:function(){return this.position.y}},{key:"maxX",get:function(){return this.position.x+this.w}},{key:"maxY",get:function(){return this.position.x+this.h}}]),o(t,[{key:"remove",value:function(){}},{key:"getDefaultSize",value:function(){return{w:40,h:40}}},{key:"getRect",value:function(){return this.rect}},{key:"getPosition",value:function(){return this.position}},{key:"setRect",value:function(t){this.rect=t}},{key:"setPosition",value:function(t){this.position=t}},{key:"setDirection",value:function(t){this.dirVec.x=t.x,this.dirVec.y=t.y,this.onUpdateDirection()}},{key:"onUpdateDirection",value:function(){}},{key:"update",value:function(){this.life<=0&&this.remove(),this.queue.length&&this.queue.update(),this.onUpdate()}},{key:"onUpdate",value:function(){}},{key:"onRender",value:function(){}},{key:"draw",value:function(){if(!this.display)return!1;var t=game.getCtx();t.beginPath(),t.rect(this.position.x,this.position.y,this.w,this.h),t.fillStyle=this.color,t.fill(),t.closePath(),this.onRender()}},{key:"hide",value:function(){this.display=!1}},{key:"show",value:function(){this.display=!0}},{key:"destroy",value:function(){this.hide()}},{key:"moveBy",value:function(){var t=game.getDt(),e=this.velocity*t;this.direction.up&&(this.position.y-=e),this.direction.down&&(this.position.y+=e),this.direction.left&&(this.position.x-=e),this.direction.right&&(this.position.x+=e)}},{key:"move",value:function(t){var e=game.getDt(),i=this.velocity*e*t.x,n=this.velocity*e*t.y;this.position.x+=i,this.position.y+=n}},{key:"moveTo",value:function(t){var e=game.getDt(),i=this.position.x,n=this.position.y;if(!this.state.movement){var o=i,r=n,a=t.x,s=t.y,h=Math.sqrt(Math.pow(a-o,2)+Math.pow(s-r,2)),u=Math.round((a-o)/h),l=Math.round((s-r)/h),c={endX:a,endY:s,startX:o,startY:r,distance:h,directionX:u,directionY:l};this.state.movement=c,this.dirVec.x=u,this.dirVec.y=l}if(this.state.movement){var f=this.state.movement,p=f.endX,d=f.endY,y=f.startX,v=f.startY,m=f.directionX,g=f.directionY,x=f.distance;this.position.x+=m*this.velocity*e,this.position.y+=g*this.velocity*e,Math.sqrt(Math.pow(i-y,2)+Math.pow(n-v,2))>=x&&(this.position.x=p,this.position.y=d,this.state.movement=!1)}}}]),t}(),y=(e.LevelBlock=function(t){function e(t){return p(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return f(e,d),e}(),e.Bullet=function(t){function e(t){p(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.velocity=500,i.lifeTime=5,i.damage=25,i.type="single",i.collided=!1,i.owner=t.owner,setTimeout(function(){i.outdate=!0},1e3*i.lifeTime),i}return f(e,d),o(e,[{key:"onHit",value:function(){}},{key:"onMiss",value:function(){}},{key:"onUpdate",value:function(){var t=this;this.move(this.dirVec),(0,u.default)(game.tree,this.position.x,this.position.y,3).forEach(function(e,i){var n,o,r;t!==e&&t.owner!==e&&(o=e,r=!1,(n=t).x<o.x+o.w&&n.x+n.w>o.x&&n.y<o.y+o.h&&n.y+n.h>o.y&&(r=!0),r&&(t.collided||(t.collided=!0,e&&"function"==typeof e.damage&&e.damage(t.damage,t.type))))})}}]),e}()),v=e.Tank=function(t){function e(t){p(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i.life=100,i.bullets=5,i.velocity=35,i.tower_angle=180,i.tower_velocity=2,i.bulletbuffer=[],i.components=[],i.gunDirection=new h.default(0,0);var n=t.color,o=t.headColor,r=t.gunColor;return i.color=n||"#4691ff",i.radius=2*i.w,i.headColor=o||"black",i.gunColor=r||"white",i.restore=!1,i.setGunAngle(),i}return f(e,d),o(e,[{key:"damage",value:function(t,e){this.life>0?this.life-=t:this.life=0}},{key:"setGunAngle",value:function(){this.gunAngle=90}},{key:"setHeadColor",value:function(t){this.headColor=t}},{key:"addComponent",value:function(t){this.components.push(t)}},{key:"removeComponent",value:function(t){var e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)}},{key:"initPlayer",value:function(){this.enableControls(),this.player=!0}},{key:"showReloadText",value:function(){var t=game.getCtx();t.fillStyle="black",t.font="14px Helvetica",t.fillText("Reloading...",innerWidth/2,innerHeight/2)}},{key:"updateComponents",value:function(){this.components.forEach(function(t){t.update()})}},{key:"drawHealthBar",value:function(t,e){var i="hp: "+this.life,n=game.getCtx();n.fillStyle="black",n.font="18px Helvetica",n.fillText(i,t,e)}},{key:"drawBulletCountLabel",value:function(t,e){var i="Bullets: "+this.bullets,n=game.getCtx();n.fillStyle="black",n.font="18px Helvetica",n.fillText(i,t,e)}},{key:"fire",value:function(){Date.now();if(0===this.bullets)return this.state.reloading=!0,!1;var t=this.dirVec.y>0||this.dirVec.y<0,e=new y({rect:t?{w:3,h:8}:{w:8,h:3},color:"red",owner:this});e.dirVec=n({},this.dirVec),e.setPosition(new h.default(this.gunDirection.x,this.gunDirection.y)),e.state.moving=!0,this.bulletbuffer.push(e),game.tree.insert(e),this.bullets--}},{key:"moveGun",value:function(t){t.right&&(this.tower_angle+=tower_velocity),t.left&&(this.tower_angle-=tower_velocity)}},{key:"updateBullets",value:function(){var t=this;this.bulletbuffer.forEach(function(e,i){e.outdate||e.collided?(game.tree.remove(e),t.bulletbuffer.shift()):e.update()}),this.bullets<=0&&!this.state.reloading&&(this.state.reloading=!0,setTimeout(function(){t.bullets+=5,t.state.reloading=!1},1500))}},{key:"drawGun",value:function(t){var e=this.dirVec,i=e.x,n=e.y;0===i&&-1===n?this.gunAngle=270:0===i&&1===n?this.gunAngle=90:1===i&&0===n?this.gunAngle=0:-1===i&0===n&&(this.gunAngle=180);var o=Math.PI/180*this.gunAngle;this.headHalfWidth=this.headWidth/2,this.headHalfHeight=this.headHeight/2,this.gunPosition=new h.default(this.headX+this.headHalfWidth,this.headY+this.headHalfWidth);var r=this.radius/3,a=this.headX+this.headHalfWidth+r*Math.cos(o),s=this.headY+this.headHalfHeight+r*Math.sin(o);this.gunDirection.x=a,this.gunDirection.y=s,t.beginPath(),t.strokeStyle=this.gunColor,t.moveTo(this.gunPosition.x,this.gunPosition.y),t.lineTo(a,s),t.lineWidth=2,t.stroke(),t.lineWidth=1,t.closePath()}},{key:"drawHead",value:function(t){this.headX=this.x+15,this.headY=this.y+15,this.headWidth=this.w-30,this.headHeight=this.h-30,t.beginPath(),t.fillStyle=this.headColor,t.fillRect(this.headX,this.headY,this.headWidth,this.headHeight),t.closePath()}},{key:"drawBody",value:function(t){t.beginPath(),t.rect(this.position.x,this.position.y,this.w,this.h),t.fillStyle=this.color,t.fill(),t.closePath()}},{key:"draw",value:function(){if(!this.display)return!1;var t=game.getCtx();this.drawBody(t),this.drawHead(t),this.drawGun(t),this.onRender()}},{key:"onRender",value:function(){if(this.player){var t=innerWidth-80,e=innerHeight-10;this.drawBulletCountLabel(t,e),this.drawHealthBar(5,innerHeight-10)}this.state.reloading&&this.player&&this.showReloadText(),this.bulletbuffer.forEach(function(t){t.draw()})}},{key:"onUpdate",value:function(){this.moveBy(),this.updateBullets(),this.updateComponents()}},{key:"onKeyPress",value:function(t,e){var i="keydown"===e;this.direction[t]=!!i}},{key:"enableControls",value:function(){var t=this,e=function(e){var i=e.keyCode,n=e.type,o={38:{name:"up",vec:new h.default(0,-1),axis:"y"},40:{name:"down",vec:new h.default(0,1),axis:"y"},37:{name:"left",vec:new h.default(-1,0),axis:"x"},39:{name:"right",vec:new h.default(1,0),axis:"x"}}[i];if(o){var r=o.name,a=o.vec;o.axis;t.dirVec=a,t.onKeyPress(r,n)}32===i&&"keyup"===n&&(t.state.reloading||(t.lastFireTime||(t.lastFireTime=game.lastLoopTime),game.lastLoopTime-t.lastFireTime>1e3&&(t.fire(),t.lastFireTime=null)))};["keydown","keyup"].forEach(function(t){addEventListener(t,e)})}}]),e}(),m=(e.EnemyTank=function(t){function e(t){p(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.velocity=50,i.scanRange=600,i.unit=!0,i.fsm=new s.StackFSM,i.initCPU(),i.scanner=(0,r.throttle)(i.scanLine,1e3,i),i}return f(e,v),o(e,[{key:"initCPU",value:function(){var t=this;this.cpu=!0,setTimeout(function(){t.fsm.pushState(function(){return t.stateScout()})},1e3*(0,r.getRandomNum)(1,5))}},{key:"onUpdate",value:function(){this.updateBullets(),this.fsm.update()}},{key:"scanLine",value:function(){console.log(Date.now())}},{key:"stateChangeWeapon",value:function(t,e){}},{key:"stateMoveTo",value:function(t,e){}},{key:"stateAvoidAttack",value:function(){}},{key:"stateAttack",value:function(){}},{key:"stateDoGroup",value:function(){}},{key:"stateScout",value:function(){var t=this;if(!this.queue.length){var e=(0,r.getRandomNum)(3,4)+1,i=(0,r.getRandomNum)(50,100)+1;this.queue.push("moveTo",-1*i*e,1,!0),this.queue.push("moveTo",1*i*e,1,!0)}this.lastScoutScan||(this.lastScoutScan=game.lastLoopTime/1e3),game.lastLoopTime/1e3-this.lastScoutScan>1.5&&((0,u.default)(game.tree,this.x,this.y,10).map(function(e){if(e.player){var i=e.x<t.x&&-1==t.dirVec.x||e.x>t.x&&-1==t.dirVec.x,n=e.y<t.y&&1==t.dirVec.y||e.y>t.y&&1==t.dirVec.y,o=t.y-100<e.y&&t.y+100>e.y,r=t.x-100<e.x&&t.x+100>e.y;if(i&&o||n&&r){t.fire();var a=t.dirVec.x*(e.x/10);t.queue.push("moveTo",a,0,!0)}}}),this.lastScoutScan=null)}}]),e}(),e.Enemy=function t(){p(this,t)}),g=function(t){function e(){return p(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,m),e}();!function(t){function e(){return p(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}f(e,g)}()},function(t,e,i){"use strict";function n(t,e,i,n,a){!function t(e,i,n,r,a){for(;r>n;){if(r-n>600){var s=r-n+1,h=i-n+1,u=Math.log(s),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(s-l)/s)*(h-s/2<0?-1:1),f=Math.max(n,Math.floor(i-h*l/s+c)),p=Math.min(r,Math.floor(i+(s-h)*l/s+c));t(e,i,f,p,a)}var d=e[i],y=n,v=r;for(o(e,n,i),a(e[r],d)>0&&o(e,n,r);y<v;){for(o(e,y,v),y++,v--;a(e[y],d)<0;)y++;for(;a(e[v],d)>0;)v--}0===a(e[n],d)?o(e,n,v):o(e,++v,r),v<=i&&(n=v+1),i<=v&&(r=v-1)}}(t,e,i||0,n||t.length-1,a||r)}function o(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function r(t,e){return t<e?-1:t>e?1:0}t.exports=n,t.exports.default=n},function(t,e,i){"use strict";t.exports=o,t.exports.default=o;var n=i(3);function o(t,e){if(!(this instanceof o))return new o(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,n,o){o||(o=y(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var r,a=e;a<i;a++)r=t.children[a],h(o,t.leaf?n(r):r);return o}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(t,e,i,o,r){for(var a,s=[e,i];s.length;)(i=s.pop())-(e=s.pop())<=o||(a=e+Math.ceil((i-e)/o/2)*o,n(t,a,e,i,r),s.push(e,a,a,i))}o.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!d(t,e))return i;for(var o,r,a,s,h=[];e;){for(o=0,r=e.children.length;o<r;o++)a=e.children[o],d(t,s=e.leaf?n(a):a)&&(e.leaf?i.push(a):p(t,s)?this._all(a,i):h.push(a));e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!d(t,e))return!1;for(var n,o,r,a,s=[];e;){for(n=0,o=e.children.length;n<o;n++)if(r=e.children[n],d(t,a=e.leaf?i(r):r)){if(e.leaf||p(t,a))return!0;s.push(r)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(t,e){if(!t)return this;for(var i,n,o,a,s=this.data,h=this.toBBox(t),u=[],l=[];s||u.length;){if(s||(s=u.pop(),n=u[u.length-1],i=l.pop(),a=!0),s.leaf&&-1!==(o=r(t,s.children,e)))return s.children.splice(o,1),u.push(s),this._condense(u),this;a||s.leaf||!p(s,h)?n?(i++,s=n.children[i],a=!1):s=null:(u.push(s),l.push(i),i=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var o,r=i-e+1,s=this._maxEntries;if(r<=s)return a(o=y(t.slice(e,i+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,n-1))),(o=y([])).leaf=!1,o.height=n;var h,u,l,c,f=Math.ceil(r/s),p=f*Math.ceil(Math.sqrt(s));for(v(t,e,i,p,this.compareMinX),h=e;h<=i;h+=p)for(v(t,h,l=Math.min(h+p-1,i),f,this.compareMinY),u=h;u<=l;u+=f)c=Math.min(u+f-1,l),o.children.push(this._build(t,u,c,n-1));return a(o,this.toBBox),o},_chooseSubtree:function(t,e,i,n){for(var o,r,a,s,h,u,l,f,p,d;n.push(e),!e.leaf&&n.length-1!==i;){for(l=f=1/0,o=0,r=e.children.length;o<r;o++)h=c(a=e.children[o]),p=t,d=a,(u=(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-h)<f?(f=u,l=h<l?h:l,s=a):u===f&&h<l&&(l=h,s=a);e=s||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,o=i?t:n(t),r=[],a=this._chooseSubtree(o,this.data,e,r);for(a.children.push(t),h(a,o);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(o,r,e)},_split:function(t,e){var i=t[e],n=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,n);var r=this._chooseSplitIndex(i,o,n),s=y(i.children.splice(r,i.children.length-r));s.height=i.height,s.leaf=i.leaf,a(i,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,o,r,a,h,u,l,f,p,d,y,v,m,g;for(u=l=1/0,n=e;n<=i-e;n++)o=s(t,0,n,this.toBBox),r=s(t,n,i,this.toBBox),p=o,d=r,void 0,void 0,void 0,void 0,y=Math.max(p.minX,d.minX),v=Math.max(p.minY,d.minY),m=Math.min(p.maxX,d.maxX),g=Math.min(p.maxY,d.maxY),a=Math.max(0,m-y)*Math.max(0,g-v),h=c(o)+c(r),a<u?(u=a,f=n,l=h<l?h:l):a===u&&h<l&&(l=h,f=n);return f},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:u,o=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,o)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var o,r,a=this.toBBox,u=s(t,0,e,a),l=s(t,i-e,i,a),c=f(u)+f(l);for(o=e;o<i-e;o++)r=t.children[o],h(u,t.leaf?a(r):r),c+=f(u);for(o=i-e-1;o>=e;o--)r=t.children[o],h(l,t.leaf?a(r):r),c+=f(l);return c},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)h(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,[{key:"constuctor",value:function(t,e){var i=e.x,n=e.y,o=e.width,r=e.height,a=e.title;e.children;this.tpl=e.tpl,this.x=i,this.y=n,this.model=e.model,this.width=o,this.height=r,this.title=a,this.model.listen("update",this.render())}},{key:"setModel",value:function(t){this.model=t}},{key:"getModel",value:function(){return this.model}},{key:"render",value:function(){this.el.insertAdjacentHTML("beforeBegin",this.tpl(this.model.getAttrs()))}}]),t}();e.default={Views:{Panel:o}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.testLevel1=void 0;var n=i(2),o=(i(5),s(i(4))),r=s(i(1)),a=i(0);function s(t){return t&&t.__esModule?t:{default:t}}var h=[[1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,2,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1]];e.testLevel1=function t(e){var i=void 0,s=Object.create({map:t,objects:[],game:e}),u=function(t,e){var i=e.indexOf(t);i>-1&&e.splice(i,1)},l=function(){u(this,e.objects),u(this,s.objects),e.tree.remove(this)};s.update=function(){this.objects.forEach(function(t){t.update()})},s.render=function(){this.objects.forEach(function(t){t.draw()})},s.testMap=h;var c=s.testMap.length-1;s.rows=c;for(var f=void 0,p=0;p<=c;p++){var d=s.testMap[p].length-1;s.cells=d;for(var y=0;y<=d;y++){var v=s.testMap[p][y];2===v&&(v=1,f=new n.Tank({remove:l,color:"#03a9f4",position:new r.default(51*y,51*p)})),i=(0,a.lvlBlockFactory)(v,p,y),s.objects.push(i)}}var m=new n.EnemyTank({remove:l,color:"green",position:new r.default(innerWidth-100,innerHeight/2)}),g=new n.EnemyTank({remove:l,color:"red",position:new r.default(innerWidth-100,innerHeight/2-50)}),x=new n.EnemyTank({remove:l,color:"black",headColor:"#03a9f4",position:new r.default(innerWidth-100,innerHeight/2-100)}),w=new n.EnemyTank({remove:l,color:"silver",headColor:"black",position:new r.default(innerWidth-100,innerHeight/2-150)}),b=new n.EnemyTank({remove:l,color:"aqua",headColor:"blue",position:new r.default(innerWidth-100,innerHeight/2+150)}),k=new n.EnemyTank({remove:l,color:"orange",headColor:"black",position:new r.default(innerWidth-100,innerHeight/2+50)}),M=new n.EnemyTank({remove:l,color:"brown",headColor:"black",position:new r.default(innerWidth-100,innerHeight/2+100)});return window.enemyTank=m,f.initPlayer(),e.objects=[f,m,g,x,w,b,k,M],e.tree=(0,o.default)().load(e.objects),s.objects=s.objects.concat(e.objects),s}},function(t,e,i){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||o,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function o(t,e){return t<e?-1:t>e?1:0}t.exports=n,t.exports.default=n,n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var o=t-1>>1,r=e[o];if(i(n,r)>=0)break;e[t]=r,t=o}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,o=e[t];t<n;){var r=1+(t<<1),a=r+1,s=e[r];if(a<this.length&&i(e[a],s)<0&&(r=a,s=e[a]),i(s,o)>=0)break;e[t]=s,t=r}e[t]=o}}},function(t,e,i){"use strict";var n=i(7);function o(t,e){return t.dist-e.dist}function r(t,e,i){var n=a(t,i.minX,i.maxX),o=a(e,i.minY,i.maxY);return n*n+o*o}function a(t,e,i){return t<e?e-t:t<=i?0:t-i}t.exports=function(t,e,i,a,s){var h,u,l=t.data,c=[],f=t.toBBox,p=new n(null,o);for(;l;){for(h=0;h<l.children.length;h++)u=l.children[h],p.push({node:u,isItem:l.leaf,dist:r(e,i,l.leaf?f(u):u)});for(;p.length&&p.peek().isItem;){var d=p.pop().node;if(s&&!s(d)||c.push(d),a&&c.length===a)return c}(l=p.pop())&&(l=l.node)}return c}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.StackFSM=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stack=[]}return n(t,[{key:"popState",value:function(){return this.stack.pop()}},{key:"pushState",value:function(t){this.getCurrentState()!==t&&this.stack.push(t)}},{key:"getCurrentState",value:function(){return this.stack.length>0?this.stack[this.stack.length-1]:null}},{key:"update",value:function(){var t=this.getCurrentState();null!==t&&t()}}]),t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={moveTo:{init:function(t,e,i){if("number"!=typeof t||"number"!=typeof e)return new Error("x, y is requried");var n=this.state,o=this.target;n.position=i?{x:o.x+t,y:o.y+e}:{x:t,y:e}},update:function(){var t=this.state,e=this.target;t.endX=e.position.x===t.position.x,t.endY=e.position.y===t.position.y,t.endX&&t.endY?this.complete():e.moveTo(t.position)}},fire:{init:function(t,e){if(t<-1||t>1)throw new Error("x has not normalized value");if(e<-1||e>1)throw new Error("y has not normalized value");void 0!==t&&void 0!==e&&(this.target.dirVec.x=t,this.target.dirVec.y=e)},update:function(){this.target.fire(),this.complete()}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Command=e.CommandQueue=void 0;var n,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(10),a=(n=r)&&n.__esModule?n:{default:n};function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.CommandQueue=function(){function t(e){s(this,t),this.queue=[],this.target=e||null}return o(t,[{key:"getFirst",value:function(){return this.queue[0]}},{key:"pop",value:function(){var t=this.queue.shift();if(this.queue.length>0){var e=this.getFirst();"idle"===e.getStatus()&&e.run.apply(e,e.args)}return t}},{key:"update",value:function(){this.queue.length>0&&this.getFirst().update()}},{key:"clear",value:function(){this.queue=[]}},{key:"log",value:function(){console.log(this.queue)}},{key:"push",value:function(t){var e=new h(this.target,t),i=Array.prototype.slice.call(arguments,1);return 0===this.length?e.run.apply(e,i):e.args=i,this.queue.push(e),e}},{key:"length",get:function(){return this.queue.length}}]),t}();var h=e.Command=function(){function t(e,i){if(s(this,t),!i)throw new Error("name field is required by Command constructor");this.statuses={0:"idle",1:"is-running",2:"paused",3:"completed",4:"aborted",5:"waiting"},this.target=e,this.currentStatus=0,this.name=i,this.state={}}return o(t,[{key:"getName",value:function(){return this.name}},{key:"run",value:function(){var t="Cant find command with name: "+this.name,e=a.default[this.name];if(!e)throw new Error(t);this.job=e,this.currentStatus=1,this.job.init.apply(this,arguments)}},{key:"stop",value:function(){this.currentStatus=2}},{key:"end",value:function(){this.currentStatus=4}},{key:"getStatus",value:function(){return this.statuses[this.currentStatus]}},{key:"update",value:function(){this.job&&this.job.update&&this.job.update.call(this)}},{key:"complete",value:function(){this.currentStatus=3,this.target.queue.pop()}}]),t}()},function(t,e,i){var n,o;n=[i,e,i(0)],void 0===(o=function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(){this.maxFps=100,this.listeners=[],this.state={paused:!1},this.time={seconds:0,minutes:0,hours:0},this.frameDuration=1/this.maxFps}return t.getCanvasCtx=function(){throw new Error("Method not implemented.")},t.prototype.pause=function(){this.state.paused=!0,this.lastPausedTime=Date.now()},t.prototype.play=function(){this.state.paused=!1,this.loop()},t.prototype.onResize=function(){},t.prototype.onMouseMove=function(){},t.prototype.setCanvasEl=function(t){t?t&&(this.canvasEl=t):this.canvasEl=i.getCanvasEl()},t.prototype.getDt=function(){return this.dt},t.prototype.getCtx=function(){return this.ctx=this.canvasEl.getContext("2d"),this.ctx},t.prototype.setContext=function(){this.ctx=t.getCanvasCtx()},t.prototype.addListeners=function(){var t=this;addEventListener("mousemove",function(e){t.mouse.x=e.clientX,t.mouse.y=e.clientY}),addEventListener("resize",function(){t.canvas.width=innerWidth,t.canvas.height=innerHeight,t.start()})},t.prototype.loop=function(){var t=this;this.reqId=requestAnimationFrame(function(){return t.loop()});var e=performance.now();if(!this.lastLoopTime)return this.lastLoopTime=e,!1;this.dt=(e-this.lastLoopTime)/1e3,this.dt>this.frameDuration&&(this.fps=1/this.dt,this.update(),this.render(),this.lastLoopTime=e-this.dt%this.frameDuration,this.time.seconds=this.lastLoopTime/1e3)},t.prototype.update=function(){this.paused||this.currentLevel.update(this)},t.prototype.loadLevel=function(t){var e=t.fn;this.currentLevel=e(this)},t.prototype.render=function(){var t,e,i,n,o;this.getCtx().clearRect(0,0,this.canvasEl.width,this.canvasEl.height),this.currentLevel.render(this),t=this.getCtx(),e=this.fps,i=innerWidth-50,n=25,o="black",t.fillStyle=o||"black",t.font="20px Helvetica",t.fillText(String(Math.round(e)),i+20,n-5)},t.prototype.start=function(){this.state.paused||this.play()},t}();e.default=n}.apply(e,n))||(t.exports=o)},function(t,e,i){"use strict";var n,o=i(12),r=(n=o)&&n.__esModule?n:{default:n},a=i(6);document.addEventListener("DOMContentLoaded",function(){var t;(t=window.game=new r.default).setCanvasEl(),t.loadLevel({fn:a.testLevel1},"test-1"),t.start()})}]);
//# sourceMappingURL=bundle.js.map